schema: '2.0'
stages:
  prepare_split:
    cmd: python3 -m src.data.prepare_split
    deps:
    - path: src/data/prepare_split.py
      hash: md5
      md5: 5883f825cda15a320f00903851498eb3
      size: 856
    params:
      params.yaml:
        seed: 50
        split.test_percent: 0.1
        split.train_percent: 1
    outs:
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
  train_baseline:
    cmd: python3 -m experiments.train_baseline
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
    - path: experiments/train_baseline.py
      hash: md5
      md5: 54fa9507b74d6cb968a2ccc3cc164c54
      size: 1828
    params:
      params.yaml:
        baseline.train.epochs: 1
        baseline.train.learning_rate: 0.001
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
    outs:
    - path: checkpoints/baseline_model.pt
      hash: md5
      md5: 4e3442a62cbb2e08c19298cb693a4a57
      size: 44804939
  evaluate@baseline:
    cmd: python3 -m experiments.evaluate --model_type baseline
    deps:
    - path: checkpoints/baseline_model.pt
      hash: md5
      md5: 4e3442a62cbb2e08c19298cb693a4a57
      size: 44804939
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
    - path: experiments/evaluate.py
      hash: md5
      md5: 5d99a8baa4b6c20d2886c871584d97b0
      size: 2607
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/baseline_acc.json
      hash: md5
      md5: 74ddd89eabab7fae2e94c1fb2abe933b
      size: 22
  pretrain_ae:
    cmd: python -m pretrain.ae_pretrain
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: pretrain/ae_pretrain.py
      hash: md5
      md5: 92a647d17a664da67f92edb47ff3e21a
      size: 2223
    - path: src/models/ae.py
      hash: md5
      md5: 1419033b6ce4f8f48ad451226352c5da
      size: 2372
    params:
      params.yaml:
        ae.freeze: false
        ae.pretrain.epochs: 1
        ae.pretrain.learning_rate: 0.001
        ae.recon_loss_weight: 0.5
        model.latent_channels: 128
    outs:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: d88defd825e246355bf251f1041429c9
      size: 599064
  train_ae:
    cmd: python -m experiments.train_ae_on_pooling
    deps:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: d88defd825e246355bf251f1041429c9
      size: 599064
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/train_ae_on_pooling.py
      hash: md5
      md5: 409285bb64ab8d867ba3eb70fe67e882
      size: 3095
    - path: src/models/ae.py
      hash: md5
      md5: 1419033b6ce4f8f48ad451226352c5da
      size: 2372
    params:
      params.yaml:
        ae.freeze: false
        ae.recon_loss_weight: 0.5
        ae.train.cls_loss_weight: 1.0
        ae.train.epochs: 5
        ae.train.learning_rate: 0.001
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: checkpoints/ae_model.pt
      hash: md5
      md5: c92fb7fbf8c4a6654ee24f2f2e10fe54
      size: 45404142
  pretrain_vae:
    cmd: python -m pretrain.vae_pretrain
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: pretrain/vae_pretrain.py
      hash: md5
      md5: 168ede8e56aa12d86b151ae90103e2d6
      size: 2300
    - path: src/models/vae.py
      hash: md5
      md5: b4fce020c311b401e8aa443107f67c09
      size: 4500
    params:
      params.yaml:
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
        vae.pretrain.epochs: 1
        vae.pretrain.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: daace9b61abee8f3822f3a44def76561
      size: 90939550
  train_vae:
    cmd: python -m experiments.train_vae_on_pooling
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: daace9b61abee8f3822f3a44def76561
      size: 90939550
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/train_vae_on_pooling.py
      hash: md5
      md5: 263a39343e6fa3176020ff9daac95a1a
      size: 2894
    - path: src/models/vae.py
      hash: md5
      md5: b4fce020c311b401e8aa443107f67c09
      size: 4500
    params:
      params.yaml:
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
        vae.train.cls_loss_weight: 5
        vae.train.epochs: 1
        vae.train.learning_rate: 0.0001
        vae.train.weight_decay: 1e-06
    outs:
    - path: checkpoints/vae_model.pt
      hash: md5
      md5: 35441fd316a4369d0b216ed5f465d48d
      size: 135745274
  evaluate@vae:
    cmd: python -m experiments.evaluate --model_type vae
    deps:
    - path: checkpoints/vae_model.pt
      hash: md5
      md5: 35441fd316a4369d0b216ed5f465d48d
      size: 135745274
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/evaluate.py
      hash: md5
      md5: f401a771262abe7d5a9360a0f9a5d0be
      size: 2647
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/vae_acc.json
      hash: md5
      md5: a3f53cf1b6ee59d041a6610205aa33e3
      size: 23
  evaluate@ae:
    cmd: python -m experiments.evaluate --model_type ae
    deps:
    - path: checkpoints/ae_model.pt
      hash: md5
      md5: c92fb7fbf8c4a6654ee24f2f2e10fe54
      size: 45404142
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/evaluate.py
      hash: md5
      md5: f401a771262abe7d5a9360a0f9a5d0be
      size: 2647
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/ae_acc.json
      hash: md5
      md5: 08a98ba303598134b67070a43bd6be13
      size: 24
  pretrain_pool@ae:
    cmd: python -m pretrain.pretrain_pool_encoder --pool_type ae
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: pretrain/pretrain_pool_encoder.py
      hash: md5
      md5: 79aa5cc29bdd0db4a3f42bd003229e5e
      size: 5149
    - path: src/models/ae.py
      hash: md5
      md5: 5590278dd5ef23f7635abb1f1b7de7e1
      size: 2246
    - path: src/models/vae.py
      hash: md5
      md5: 0ef7cfc58aa13929c08fcdaa4160e1b3
      size: 3179
    params:
      params.yaml:
        ae.pretrain.epochs: 1
        ae.pretrain.learning_rate: 0.001
        ae.recon_loss_weight: 0.5
        model.latent_channels: 128
        model.pretrained: true
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
    outs:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: 78b60adad7bf49569bf610194e780685
      size: 4736792
  pretrain_pool@vae:
    cmd: python3 -m pretrain.pretrain_pool_encoder --pool_type vae
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
    - path: pretrain/pretrain_pool_encoder.py
      hash: md5
      md5: 6df987045ef5275d7705f593a7757e53
      size: 5008
    - path: src/models/ae.py
      hash: md5
      md5: 01643e3f833902dbb95a4ce9e214ef64
      size: 2175
    - path: src/models/vae.py
      hash: md5
      md5: b42fd156e1b7f904c826b945a9ac4b00
      size: 3087
    params:
      params.yaml:
        ae.recon_loss_weight: 0.5
        model.latent_channels: 128
        model.pretrained: true
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
        vae.pretrain.epochs: 1
        vae.pretrain.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: 9cecc9793820d7bba87a9d35d303e427
      size: 11186381
  train_with_pool@0:
    cmd: python3 -m experiments.train_resnet_with_pool --pool_type vae 
      --freeze_encoder true
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: 9cecc9793820d7bba87a9d35d303e427
      size: 11186381
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: 1d10416dd9abd73b3015028b8658a564
      size: 4196
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
        vae.train.epochs: 3
        vae.train.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_frozen_model.pt
      hash: md5
      md5: 1a3337041e431dde10c1de93a0acfa3c
      size: 56239387
  train_with_pool@1:
    cmd: python3 -m experiments.train_resnet_with_pool --pool_type vae 
      --freeze_encoder false
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: 9cecc9793820d7bba87a9d35d303e427
      size: 11186381
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: 1d10416dd9abd73b3015028b8658a564
      size: 4196
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
        vae.train.epochs: 3
        vae.train.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_unfrozen_model.pt
      hash: md5
      md5: 388dac29fb4e3f7d557e8b99440469ad
      size: 56239739
  train_with_pool@2:
    cmd: python -m experiments.train_resnet_with_pool --pool_type vae 
      --freeze_encoder true
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: 4175a97fccdb1b384ebdfa0a3cb34241
      size: 11186610
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: 6d0923e4feff3abdd2abb5efabd9b4b5
      size: 3009
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
        vae.train.epochs: 1
        vae.train.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_frozen_model.pt
      hash: md5
      md5: 9d5bba2f9b4d5bdc26513ade9acc2386
      size: 56241340
  train_with_pool@3:
    cmd: python -m experiments.train_resnet_with_pool --pool_type vae 
      --freeze_encoder false
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: 4175a97fccdb1b384ebdfa0a3cb34241
      size: 11186610
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: 6d0923e4feff3abdd2abb5efabd9b4b5
      size: 3009
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
        vae.train.epochs: 1
        vae.train.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_unfrozen_model.pt
      hash: md5
      md5: 17d0cae29eb2f6263f0305f9eda56a72
      size: 56241688
  evaluate@ae_frozen:
    cmd: python -m experiments.evaluate --model_type ae_frozen
    deps:
    - path: checkpoints/ae_frozen_model.pt
      hash: md5
      md5: aa97d8b13006f82b8c8aa56dec5e5ffc
      size: 47245912
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/evaluate.py
      hash: md5
      md5: 7225543ac67026776fb5f77beb51275e
      size: 2714
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/ae_frozen_acc.json
      hash: md5
      md5: 8f1d21beb116f40ea9d5d83edb5ca90d
      size: 24
  evaluate@ae_unfrozen:
    cmd: python -m experiments.evaluate --model_type ae_unfrozen
    deps:
    - path: checkpoints/ae_unfrozen_model.pt
      hash: md5
      md5: 392a4d4fc3302fdd03b586fefb532156
      size: 47246178
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/evaluate.py
      hash: md5
      md5: 7225543ac67026776fb5f77beb51275e
      size: 2714
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/ae_unfrozen_acc.json
      hash: md5
      md5: 08a98ba303598134b67070a43bd6be13
      size: 24
  evaluate@vae_frozen:
    cmd: python3 -m experiments.evaluate --model_type vae_frozen
    deps:
    - path: checkpoints/vae_frozen_model.pt
      hash: md5
      md5: 1a3337041e431dde10c1de93a0acfa3c
      size: 56239387
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
    - path: experiments/evaluate.py
      hash: md5
      md5: 5d99a8baa4b6c20d2886c871584d97b0
      size: 2607
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/vae_frozen_acc.json
      hash: md5
      md5: 2e0b64cfa6d5fec6a6cd15224f73d319
      size: 22
  evaluate@vae_unfrozen:
    cmd: python3 -m experiments.evaluate --model_type vae_unfrozen
    deps:
    - path: checkpoints/vae_unfrozen_model.pt
      hash: md5
      md5: 388dac29fb4e3f7d557e8b99440469ad
      size: 56239739
    - path: data/cifar_split.npz
      hash: md5
      md5: f2a1d148bdbad67aa54f66977bf3f469
      size: 4600
    - path: experiments/evaluate.py
      hash: md5
      md5: 5d99a8baa4b6c20d2886c871584d97b0
      size: 2607
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/vae_unfrozen_acc.json
      hash: md5
      md5: 23b4b33e4e2dacdc3fe3c0505fadc562
      size: 22
  summarize:
    cmd: python3 -m experiments.summarize
    deps:
    - path: experiments/evaluate.py
      hash: md5
      md5: 5d99a8baa4b6c20d2886c871584d97b0
      size: 2607
    - path: experiments/summarize.py
      hash: md5
      md5: 77599b4233546b729634968abdef8868
      size: 1374
    outs:
    - path: results/plt/test_acc.png
      hash: md5
      md5: 3de6eae7c036a2065398c4b1f946c843
      size: 22743
