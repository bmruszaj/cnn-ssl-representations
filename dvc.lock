schema: '2.0'
stages:
  prepare_split:
    cmd: python -m src.data.prepare_split
    deps:
    - path: src/data/prepare_split.py
      hash: md5
      md5: dd443eccf1b47fbf0b48c2db970aec32
      size: 879
    params:
      params.yaml:
        seed: 50
        split.test_percent: 10
        split.train_percent: 10
    outs:
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
  train_baseline:
    cmd: python -m experiments.train_baseline
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/train_baseline.py
      hash: md5
      md5: 731315652e37c9f882bbd6221fa3eb5c
      size: 1883
    params:
      params.yaml:
        baseline.train.epochs: 20
        baseline.train.learning_rate: 0.001
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
    outs:
    - path: checkpoints/baseline_model.pt
      hash: md5
      md5: 89560e20e98abcaf7460b55600821911
      size: 44806256
  evaluate@baseline:
    cmd: python -m experiments.evaluate --model_type baseline
    deps:
    - path: checkpoints/baseline_model.pt
      hash: md5
      md5: 89560e20e98abcaf7460b55600821911
      size: 44806256
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/evaluate.py
      hash: md5
      md5: 73edf71ffc497cf22380c477d0574d7c
      size: 2684
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/baseline_acc.json
      hash: md5
      md5: 432e7c3a1bab035e515d58fbba3db9f3
      size: 24
  pretrain_ae:
    cmd: python -m pretrain.ae_pretrain
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: pretrain/ae_pretrain.py
      hash: md5
      md5: 92a647d17a664da67f92edb47ff3e21a
      size: 2223
    - path: src/models/ae.py
      hash: md5
      md5: 1419033b6ce4f8f48ad451226352c5da
      size: 2372
    params:
      params.yaml:
        ae.freeze: false
        ae.pretrain.epochs: 1
        ae.pretrain.learning_rate: 0.001
        ae.recon_loss_weight: 0.5
        model.latent_channels: 128
    outs:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: d88defd825e246355bf251f1041429c9
      size: 599064
  train_ae:
    cmd: python -m experiments.train_ae_on_pooling
    deps:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: d88defd825e246355bf251f1041429c9
      size: 599064
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/train_ae_on_pooling.py
      hash: md5
      md5: 409285bb64ab8d867ba3eb70fe67e882
      size: 3095
    - path: src/models/ae.py
      hash: md5
      md5: 1419033b6ce4f8f48ad451226352c5da
      size: 2372
    params:
      params.yaml:
        ae.freeze: false
        ae.recon_loss_weight: 0.5
        ae.train.cls_loss_weight: 1.0
        ae.train.epochs: 5
        ae.train.learning_rate: 0.001
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: checkpoints/ae_model.pt
      hash: md5
      md5: c92fb7fbf8c4a6654ee24f2f2e10fe54
      size: 45404142
  pretrain_vae:
    cmd: python -m pretrain.vae_pretrain
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: pretrain/vae_pretrain.py
      hash: md5
      md5: 168ede8e56aa12d86b151ae90103e2d6
      size: 2300
    - path: src/models/vae.py
      hash: md5
      md5: b4fce020c311b401e8aa443107f67c09
      size: 4500
    params:
      params.yaml:
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
        vae.pretrain.epochs: 1
        vae.pretrain.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: daace9b61abee8f3822f3a44def76561
      size: 90939550
  train_vae:
    cmd: python -m experiments.train_vae_on_pooling
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: daace9b61abee8f3822f3a44def76561
      size: 90939550
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/train_vae_on_pooling.py
      hash: md5
      md5: 263a39343e6fa3176020ff9daac95a1a
      size: 2894
    - path: src/models/vae.py
      hash: md5
      md5: b4fce020c311b401e8aa443107f67c09
      size: 4500
    params:
      params.yaml:
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
        vae.train.cls_loss_weight: 5
        vae.train.epochs: 1
        vae.train.learning_rate: 0.0001
        vae.train.weight_decay: 1e-06
    outs:
    - path: checkpoints/vae_model.pt
      hash: md5
      md5: 35441fd316a4369d0b216ed5f465d48d
      size: 135745274
  evaluate@vae:
    cmd: python -m experiments.evaluate --model_type vae
    deps:
    - path: checkpoints/vae_model.pt
      hash: md5
      md5: 35441fd316a4369d0b216ed5f465d48d
      size: 135745274
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/evaluate.py
      hash: md5
      md5: f401a771262abe7d5a9360a0f9a5d0be
      size: 2647
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/vae_acc.json
      hash: md5
      md5: a3f53cf1b6ee59d041a6610205aa33e3
      size: 23
  evaluate@ae:
    cmd: python -m experiments.evaluate --model_type ae
    deps:
    - path: checkpoints/ae_model.pt
      hash: md5
      md5: c92fb7fbf8c4a6654ee24f2f2e10fe54
      size: 45404142
    - path: data/cifar_split.npz
      hash: md5
      md5: 044aec2794f209f6cf92a3c813f8d7bc
      size: 2560
    - path: experiments/evaluate.py
      hash: md5
      md5: f401a771262abe7d5a9360a0f9a5d0be
      size: 2647
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/ae_acc.json
      hash: md5
      md5: 08a98ba303598134b67070a43bd6be13
      size: 24
  pretrain_pool@ae:
    cmd: python -m pretrain.pretrain_pool_encoder --pool_type ae
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: pretrain/pretrain_pool_encoder.py
      hash: md5
      md5: 79aa5cc29bdd0db4a3f42bd003229e5e
      size: 5149
    - path: src/models/ae.py
      hash: md5
      md5: 5590278dd5ef23f7635abb1f1b7de7e1
      size: 2246
    - path: src/models/vae.py
      hash: md5
      md5: 0ef7cfc58aa13929c08fcdaa4160e1b3
      size: 3179
    params:
      params.yaml:
        ae.pretrain.epochs: 20
        ae.pretrain.learning_rate: 0.001
        ae.recon_loss_weight: 0.5
        model.latent_channels: 128
        model.pretrained: true
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
    outs:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: b46a0830dcf8f8dd7fb08b47d0cb128d
      size: 4736792
  pretrain_pool@vae:
    cmd: python -m pretrain.pretrain_pool_encoder --pool_type vae
    deps:
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: pretrain/pretrain_pool_encoder.py
      hash: md5
      md5: 79aa5cc29bdd0db4a3f42bd003229e5e
      size: 5149
    - path: src/models/ae.py
      hash: md5
      md5: 5590278dd5ef23f7635abb1f1b7de7e1
      size: 2246
    - path: src/models/vae.py
      hash: md5
      md5: 0ef7cfc58aa13929c08fcdaa4160e1b3
      size: 3179
    params:
      params.yaml:
        ae.recon_loss_weight: 0.5
        model.latent_channels: 128
        model.pretrained: true
        vae.beta: 10.0
        vae.hidden_ch: 256
        vae.latent_ch: 128
        vae.pretrain.epochs: 20
        vae.pretrain.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: ac819d0949368316d45abd88636bbdf8
      size: 11186610
  train_with_pool@0:
    cmd: python -m experiments.train_resnet_with_pool --pool_type ae 
      --freeze_encoder true
    deps:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: b46a0830dcf8f8dd7fb08b47d0cb128d
      size: 4736792
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: f22f8fb362e6590d8a5f7609fa8683df
      size: 4332
    params:
      params.yaml:
        ae.train.epochs: 20
        ae.train.learning_rate: 0.001
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
    outs:
    - path: checkpoints/ae_frozen_model.pt
      hash: md5
      md5: d40d087dbaea8b9ccd080c5e545f583d
      size: 47245912
  train_with_pool@1:
    cmd: python -m experiments.train_resnet_with_pool --pool_type ae 
      --freeze_encoder false
    deps:
    - path: checkpoints/ae_pretrained.pth
      hash: md5
      md5: b46a0830dcf8f8dd7fb08b47d0cb128d
      size: 4736792
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: f22f8fb362e6590d8a5f7609fa8683df
      size: 4332
    params:
      params.yaml:
        ae.train.epochs: 20
        ae.train.learning_rate: 0.001
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
    outs:
    - path: checkpoints/ae_unfrozen_model.pt
      hash: md5
      md5: 3000cfe264e53905c135bdb69785ffcd
      size: 47246178
  train_with_pool@2:
    cmd: python -m experiments.train_resnet_with_pool --pool_type vae 
      --freeze_encoder true
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: ac819d0949368316d45abd88636bbdf8
      size: 11186610
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: f22f8fb362e6590d8a5f7609fa8683df
      size: 4332
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
        vae.train.epochs: 20
        vae.train.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_frozen_model.pt
      hash: md5
      md5: c483318ca8a34cbfb03d22e7c6e4fe5c
      size: 56241340
  train_with_pool@3:
    cmd: python -m experiments.train_resnet_with_pool --pool_type vae 
      --freeze_encoder false
    deps:
    - path: checkpoints/vae_pretrained.pth
      hash: md5
      md5: ac819d0949368316d45abd88636bbdf8
      size: 11186610
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/train_resnet_with_pool.py
      hash: md5
      md5: f22f8fb362e6590d8a5f7609fa8683df
      size: 4332
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
        model.pretrained: true
        vae.train.epochs: 20
        vae.train.learning_rate: 0.0001
    outs:
    - path: checkpoints/vae_unfrozen_model.pt
      hash: md5
      md5: cc91231454a7b733452ef9f8306bbce3
      size: 56241688
  evaluate@ae_frozen:
    cmd: python -m experiments.evaluate --model_type ae_frozen
    deps:
    - path: checkpoints/ae_frozen_model.pt
      hash: md5
      md5: d40d087dbaea8b9ccd080c5e545f583d
      size: 47245912
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/evaluate.py
      hash: md5
      md5: 73edf71ffc497cf22380c477d0574d7c
      size: 2684
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/ae_frozen_acc.json
      hash: md5
      md5: 09fe5837c55a490746bbf402e9664e93
      size: 24
  evaluate@ae_unfrozen:
    cmd: python -m experiments.evaluate --model_type ae_unfrozen
    deps:
    - path: checkpoints/ae_unfrozen_model.pt
      hash: md5
      md5: 3000cfe264e53905c135bdb69785ffcd
      size: 47246178
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/evaluate.py
      hash: md5
      md5: 73edf71ffc497cf22380c477d0574d7c
      size: 2684
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/ae_unfrozen_acc.json
      hash: md5
      md5: 4ad606f23966537d65b32b4745f0e8dd
      size: 24
  evaluate@vae_frozen:
    cmd: python -m experiments.evaluate --model_type vae_frozen
    deps:
    - path: checkpoints/vae_frozen_model.pt
      hash: md5
      md5: c483318ca8a34cbfb03d22e7c6e4fe5c
      size: 56241340
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/evaluate.py
      hash: md5
      md5: 73edf71ffc497cf22380c477d0574d7c
      size: 2684
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/vae_frozen_acc.json
      hash: md5
      md5: a0c3546316ce7752341e8db3862964f9
      size: 24
  evaluate@vae_unfrozen:
    cmd: python -m experiments.evaluate --model_type vae_unfrozen
    deps:
    - path: checkpoints/vae_unfrozen_model.pt
      hash: md5
      md5: cc91231454a7b733452ef9f8306bbce3
      size: 56241688
    - path: data/cifar_split.npz
      hash: md5
      md5: 7a1508bc95360c39ef759bea17f47af6
      size: 24520
    - path: experiments/evaluate.py
      hash: md5
      md5: 73edf71ffc497cf22380c477d0574d7c
      size: 2684
    params:
      params.yaml:
        model.latent_channels: 128
        model.num_classes: 10
    outs:
    - path: results/vae_unfrozen_acc.json
      hash: md5
      md5: f9101ecb3e1a399368c32dcbd7e9e2aa
      size: 24
  summarize:
    cmd: python -m experiments.summarize
    deps:
    - path: experiments/evaluate.py
      hash: md5
      md5: 73edf71ffc497cf22380c477d0574d7c
      size: 2684
    - path: experiments/summarize.py
      hash: md5
      md5: c0537a2247e97ca0734e2d10a8fc9632
      size: 1425
    outs:
    - path: results/plt/test_acc.png
      hash: md5
      md5: 96c81cc6c8a191c816d74fcdc534a77e
      size: 28084
